# Refactor Prefect-ready 2025-11-09

## Contexto

La aplicación mantenía la lógica de extracción, transformación y carga acoplada a un servicio FastAPI. Las utilidades concentraban operaciones de base de datos y escritura, sin separación semántica ni tareas Prefect. No existía un flujo declarativo que pudiera ser orquestado por Prefect y la estructura de carpetas no seguía el estándar extract → transform → load.

## Decisión

Se reorganizó el código en módulos `src/core/{extractors, transformers, loaders}` con funciones puras y tareas Prefect. Se creó el flujo principal `prefect_flows/main_flow.py` que coordina las tareas usando `@flow` y `@task`, delegando la apertura de sesiones y la orquestación a Prefect. Los servicios y utilidades existentes fueron adaptados para reutilizar la nueva lógica centralizada, conservando la compatibilidad del API.

## Consecuencia

El repositorio ahora expone un flujo `main_flow` ejecutable mediante `prefect deployment run "main_flow"`, sin dependencias en workers o schedulers internos. La lógica de negocio permanece intacta pero desacoplada y modular, facilitando auditoría, pruebas y futuras ampliaciones dentro del estándar Prefect-ready.
